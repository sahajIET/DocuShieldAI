flowchart TD
    A[ğŸ‘¤ User Uploads PDF] --> B{ğŸ“‹ PDF Pre-check}
    B -->|âœ… Valid PDF| C[ğŸ“„ Text Extraction]
    B -->|âŒ Invalid/Protected| D[ğŸš« Error: Invalid PDF]
    
    C --> E{ğŸ“ PDF Type Check}
    E -->|Native PDF| F[ğŸ“– PyMuPDF Text Extraction]
    E -->|Scanned/Image PDF| G[ğŸ–¼ï¸ OpenCV Image Processing]
    
    G --> H[ğŸ‘ï¸ PyTesseract OCR]
    H --> I[ğŸ“ Extracted Text]
    F --> I
    
    I --> J[ğŸ§  Entity Detection Pipeline]
    
    J --> K[ğŸ” Presidio Analyzer<br/>Context-aware PII Detection]
    J --> L[ğŸ·ï¸ spaCy NER<br/>Named Entity Recognition]
    J --> M[ğŸ”¤ Custom Regex Patterns<br/>Pattern-based Detection]
    
    K --> N[ğŸ“Š Entity Results 1]
    L --> O[ğŸ“Š Entity Results 2]
    M --> P[ğŸ“Š Entity Results 3]
    
    N --> Q[ğŸ”§ Validation & Consolidation<br/>Resolve Overlapping Detections]
    O --> Q
    P --> Q
    
    Q --> R[âœ… Validated Entity List]
    R --> S[âš™ï¸ User Selects Redaction Types]
    S --> T[ğŸ–¤ Pixel-level Redaction<br/>PyMuPDF Black Rectangles]
    
    T --> U[ğŸ“‹ Generate Redaction Summary]
    U --> V[ğŸ“¦ Package Results]
    V --> W[â¬‡ï¸ Download Redacted PDF]
    
    %% Styling
    classDef userAction fill:#e1f5fe,stroke:#01579b,stroke-width:2px
    classDef processing fill:#f3e5f5,stroke:#4a148c,stroke-width:2px
    classDef aiProcess fill:#e8f5e8,stroke:#1b5e20,stroke-width:2px
    classDef decision fill:#fff3e0,stroke:#e65100,stroke-width:2px
    classDef output fill:#fce4ec,stroke:#880e4f,stroke-width:2px
    classDef error fill:#ffebee,stroke:#c62828,stroke-width:2px
    
    class A,S,W userAction
    class C,F,G,H,I,T,U,V processing
    class J,K,L,M,N,O,P,Q,R aiProcess
    class B,E decision
    class W output
    class D error